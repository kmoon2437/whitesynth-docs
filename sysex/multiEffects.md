# Multi effect
Multi effect는 지정된 채널에 갖가지 이펙트(distortion,overdrive 등등등 뭐가 많음)를 넣을 수 있는 기능으로, 넣은 이펙트에 따라 정말 별의별 소리를 다 낼 수 있다.
whitesynth에서는 채널별로 16개까지 사용할 수 있으며, 프리셋을 지정해 여러 채널에 공통으로 적용할 수도 있다.

## `0x24` - `0x2F` 파라미터에 대해
`0x24` - `0x2F` 파라미터는 이펙터의 종류에 상관없이 공통으로 들어가는 파라미터이다.

| 파라미터 번호 | 이름 | 값 | 기본값 | 설명 |
| --- | -------- | ----- | --- | ------------ |
| `0x24` | Level | 0 - 16383 | 이펙트 종류에 따라 변화 | 최종 출력 level을 조정한다. |
| `0x25` | (Reserved) | N/A | N/A | 추후 사용할 경우를 대비해 비워놓은 곳 |
| `0x26` | (Reserved) | N/A | N/A | 추후 사용할 경우를 대비해 비워놓은 곳 |
| `0x27` | Mode | 0 - 2 | 1(GS sysex로 이펙트 설정시 2로 고정) | 어느 시점에서 이 이펙트를 처리할지 설정한다.(아래 참고) |
| `0x28` | (Reserved) | N/A | N/A | 추후 사용할 경우를 대비해 비워놓은 곳 |
| : | : | : | : | : |
| `0x2F` | (Reserved) | N/A | N/A | 추후 사용할 경우를 대비해 비워놓은 곳 |

### `0x27` 파라미터에 대해
값이 0인 경우는 pre-process mode에 해당하며, volume 처리와 filter(cutoff: `CC#74`,resonance: `CC#71`) 처리 이전에 이펙트를 먼저 처리한다.

값이 1인 경우는 normal mode에 해당하며, volume 처리는 똑같이 하나 이펙트를 처리하기 **전에** filter(cutoff,resonance) 를 먼저 처리한다.

위 두 경우에는 이펙트 적용 후에 volume을 적용하기 때문에 `CC#7` 값이 해당 채널의 「최종」 출력 볼륨으로 적용된다.

값이 2인 경우는 post-process mode에 해당하며, volume 처리까지 모두 한 다음 이펙트 처리를 한다. 따라서 이펙트 설정의 Level 파라미터가 사실상의 최종 출력 볼륨으로 작용한다.

roland scva의 경우에는 여기서의 post-process mode와 비슷한 형태로 처리한다.

## 이펙트 종류
뭐가 엄청 많지만 사실 별로 쓰는건 없어서 (제작자가) 많이 쓰는 것부터 구현할 예정이다.  
~~취소선~~이 쳐진 건 구현 예정에 없거나 구현이 안 됐다는 뜻이다.

공식을 적어 놓은 경우, 해당 공식은 실제 파라미터 값(얘를 x라 함)을 sysex용 값으로 변환하는 공식이다.

### None - `00 00 00`
기본값. 아무것도 적용하지 않는다.

### Pan - `00 00 01`
오디오의 좌/우를 합쳐 mono 소리로 만든 다음(사실상 이 용도) 출력의 pan을 조절한다.

#### 파라미터
공통 파라미터 기본값
- `0x24` (Level): 16383

| 파라미터 번호 | 이름 | 값 | 기본값 | 설명 |
| --- | -------- | ----- | --- | ------------ |
| `0x00` | Pan | L8191(1) - Center(8192) - R8191(16383) | Center(8192) | 소리의 pan을 조절한다. |

### Stereo EQ - `41 01 00`
4 band 이퀄라이저를 적용한다.

#### 파라미터
공통 파라미터 기본값
- `0x24` (Level): 127

| 파라미터 번호 | 이름 | 값 | 기본값 | 설명 |
| --- | -------- | ----- | --- | ------------ |
| `0x00` | Low freq | 200 - 2000(Hz) | N/A | 저음역대의 기준 주파수를 설정한다. |
| `0x01` | Low gain | -12 - +12(dB)<br>(공식: x + 8192) | 0 | 저음역대의 gain을 조정한다. |
| `0x02` | High freq | 4000 - 8000(Hz) | N/A | 고음역대의 기준 주파수를 설정한다. |
| `0x03` | High gain | -12 - +12(dB)<br>(공식: x + 8192) | 0 | 고음역대의 gain을 조정한다. |
| `0x04` | Mid1 freq | 200 - 8000(Hz) | N/A | 중간 음역대 1의 기준 주파수를 설정한다. |
| `0x05` | Mid1 Q | ? | ? | 중간 음역대 1의 filter Q 값을 조정한다. |
| `0x06` | Mid1 gain | -12 - +12(dB)<br>(공식: x + 8192) | 0 | 중간 음역대 1의 gain을 조정한다. |
| `0x07` | Mid2 freq | 2 | 200 - 8000(Hz) | N/A | 중간 음역대 2의 기준 주파수를 설정한다. |
| `0x08` | Mid2 Q | ? | ? | 중간 음역대 2의 filter Q 값을 조정한다. |
| `0x09` | Mid2 gain | -12 - +12(dB)<br>(공식: x + 8192) | 0 | 중간 음역대 2의 gain을 조정한다. |

### Overdrive - `41 01 10`
일렉기타의 overdrive 이펙트를 적용한다.

#### 파라미터
공통 파라미터 기본값
- `0x24` (Level): 12288

| 파라미터 번호 | 이름 | 값 | 기본값 | 설명 |
| --- | -------- | ----- | --- | ------------ |
| `0x00` | Drive | 0 - 16383 | 6144 | drive의 정도를 조정한다. |
| `0x01` | Amp type | Small,Combo,Stack,Tube<br>(0, 1, 2, 3) | Combo (1) | 기타 앰프 종류를 선택한다.[^GuitarAmpType] |
| `0x02` | Amp on/off | off,on<br>(0, 1) | on (1) | 기타 앰프를 켜고 끈다. |

### Distortion - `41 01 11`
일렉기타의 distortion 이펙트를 적용한다.

#### 파라미터
공통 파라미터 기본값
- `0x24` (Level): 10752

| 파라미터 번호 | 이름 | 값 | 기본값 | 설명 |
| --- | -------- | ----- | --- | ------------ |
| `0x00` | Drive | 0 - 16383 | 9728 | drive의 정도를 조정한다. |
| `0x01` | Amp type | Small,Combo,Stack,Tube<br>(0, 1, 2, 3) | Tube (3) | 기타 앰프 종류를 선택한다.[^GuitarAmpType] |
| `0x02` | Amp on/off | off,on<br>(0, 1) | on (1) | 기타 앰프를 켜고 끈다. |

### Amp simulator - `00 01 00`
앰프만 쓰는 거. 여기서도 드라이브를 넣을 수는 있다.

#### 파라미터
공통 파라미터 기본값
- `0x24` (Level): 14336

| 파라미터 번호 | 이름 | 값 | 기본값 | 설명 |
| --- | -------- | ----- | --- | ------------ |
| `0x00` | Drive | 0 - 16383 | 0 | drive의 정도를 조정한다. |
| `0x01` | Amp type | Small,Combo,Stack,Tube<br>(0, 1, 2, 3) | Tube (3) | 기타 앰프 종류를 선택한다.[^GuitarAmpType] |

### Tremolo - `41 01 25`
이름 그대로이다.

#### 파라미터
공통 파라미터 기본값
- `0x24` (Level): 16383

| 파라미터 번호 | 이름 | 값 | 기본값 | 설명 |
| --- | -------- | ----- | --- | ------------ |
| `0x00` | Mod wave | 0 - 4 | N/A | modulation의 종류를 설정한다.<br>0 = Triangle wave<br>1 = Square wave<br>2 = Sine wave<br>3 = Saw wave<br>4 = 뒤집어진 Saw wave |
| `0x01` | Mod rate | 0.01 - 10.00(Hz)<br>(1 - 1000(공식: 100*x)) | N/A | modulation rate를 설정한다. |
| `0x02` | Mod depth | 0 - 16383 | N/A | modulation depth를 설정한다. |

### Compressor - `41 01 30`
흔한 컴프레서. 일정 수준을 넘어선 신호의 레벨을 줄임으로써 레벨의 격차(다이나믹 레인지)를 줄인다.

#### 파라미터
공통 파라미터 기본값
- `0x24` (Level): 16383

| 파라미터 번호 | 이름 | 값 | 기본값 | 설명 |
| --- | -------- | ----- | --- | ------------ |
| `0x00` | Attack | 0 - 16383 | N/A | threshold를 넘는 소리가 줄어드는 시간을 조정한다. 단위는 밀리초 |
| `0x01` | Makeup gain | 0 - +18<br>(공식: x) | N/A | 출력 gain을 조정한다. |
| `0x02` | Threshold | 0 - 144 | N/A | "특정한 기준점에 맞춤으로써"에서 "특정한 기준점"을 설정한다. 단위는 -dBFS. |
| `0x03` | Ratio | 0.0 - 100.0<br>(공식: 10*x) | N/A | 일반적인 컴프레서에서 Ratio를 "n : 1" 로 표기하는데 이때 n을 설정한다. |
| `0x04` | Release | 0 - 16383 | N/A | threshold에서 멀어진 볼륨이 다시 threshold에 가까워졌을 때 줄이거나 키운 볼륨을 원상복구하는 시간을 조정한다. 단위는 밀리초. |

### Reverser - `00 00 02`
정해진 주기마다 재생한 소리를 버퍼링하고 그 동안 이전에 버퍼링된 소리를 되감기로 재생한다.

#### 파라미터
공통 파라미터 기본값
- `0x24` (Level): 16383

| 파라미터 번호 | 이름 | 값 | 기본값 | 설명 |
| --- | -------- | ----- | --- | ------------ |
| `0x00` | BPM | 0 - 16383 | 120 | 템포를 설정한다. |
| `0x00` | Beats length | 0 - 16383 | 4 | 버퍼링할 소리의 길이가 몇 박자가 될지를 설정한다. BPM 값과 Beats length 값을 기준으로 소리를 버퍼링하고 되감기할 주기를 결정한다. |
| `0x00` | Mix | 0 - 16383 | 8192 | 입/출력 신호를 얼마나 섞을지 결정한다. 0 또는 1이면 입력 신호만, 16383이면 출력 신호만 출력되며, 8192면 반반으로 섞어 출력된다. |

[^GuitarAmpType]: Small = 소형 앰프,Combo = 콤보 앰프,Stack = 스택 앰프,Tube = 진공관 앰프. roland sound canvas와 호환되도록 지원할 때 각각 Small,Built-in,2 stack,3 stack에 대응하도록 구현 예정.